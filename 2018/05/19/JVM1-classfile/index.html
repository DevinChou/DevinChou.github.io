<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      JVMʵ��(һ)-����Class�ļ��ֽ��� | Rousseau Chou&#39;s Blog 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="Zhou Hangqi">
    
    

    <meta name="description" content="1.1 Class�ļ�����
��ȡ4���ֽڵ�magicֵ��CAFEBABE
��ȡ2���ֽ�minorVersion,2���ֽڵ�majorVersion
constantPool�ȶ�ȡ2���ֽڵĳ����ش�С�����ζ�ȡ�������ȶ�1���ֽڵĳ������ͣ��������͹�14�֣������ݲ�ͬ�����ٶ�ȡ��ͬ�ֽ�����   
Integer�">
<meta property="og:type" content="article">
<meta property="og:title" content="JVMʵ��(һ)-����Class�ļ��ֽ��� | Rousseau Chou's Blog">
<meta property="og:url" content="http://yoursite.com/2018/05/19/JVM1-classfile/index.html">
<meta property="og:site_name" content="Rousseau Chou's Blog">
<meta property="og:description" content="1.1 Class�ļ�����
��ȡ4���ֽڵ�magicֵ��CAFEBABE
��ȡ2���ֽ�minorVersion,2���ֽڵ�majorVersion
constantPool�ȶ�ȡ2���ֽڵĳ����ش�С�����ζ�ȡ�������ȶ�1���ֽڵĳ������ͣ��������͹�14�֣������ݲ�ͬ�����ٶ�ȡ��ͬ�ֽ�����   
Integer�">
<meta property="og:updated_time" content="2019-07-21T18:25:01.613Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JVMʵ��(һ)-����Class�ļ��ֽ��� | Rousseau Chou's Blog">
<meta name="twitter:description" content="1.1 Class�ļ�����
��ȡ4���ֽڵ�magicֵ��CAFEBABE
��ȡ2���ֽ�minorVersion,2���ֽڵ�majorVersion
constantPool�ȶ�ȡ2���ֽڵĳ����ش�С�����ζ�ȡ�������ȶ�1���ֽڵĳ������ͣ��������͹�14�֣������ݲ�ͬ�����ٶ�ȡ��ͬ�ֽ�����   
Integer�">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">Rousseau Chou&#39;s Blog</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          These violent delights have violent ends.
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">home</a></li>
              
                
                <li class="navigation__item"><a href="/categories/code" title="" class="">code</a></li>
              
                
                <li class="navigation__item"><a href="/categories/peruse" title="" class="">peruse</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">about</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">JVMʵ��(һ)-����Class�ļ��ֽ���</h1>

    

    <div class="post-meta">
      <time datetime="2018-05-19" class="post-meta__date date">2018-05-19</time> 

      <span class="post-meta__tags tags">

          
            <font class="categories">
            &#8226; 分类:
            <a class="categories-link" href="/categories/code/">code</a>
            </font>
          

          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h4 id="1-1-Class�l�����"><a href="#1-1-Class�l�����" class="headerlink" title="1.1 Class�ļ�����"></a>1.1 Class�ļ�����</h4><ol>
<li>��ȡ4���ֽڵ�<strong>magic</strong>ֵ��CAFEBABE</li>
<li>��ȡ2���ֽ�<strong>minorVersion</strong>,2���ֽڵ�<strong>majorVersion</strong></li>
<li><strong>constantPool</strong>�ȶ�ȡ2���ֽڵĳ����ش�С�����ζ�ȡ�������ȶ�1���ֽڵĳ������ͣ��������͹�14�֣������ݲ�ͬ�����ٶ�ȡ��ͬ�ֽ�����   <ol>
<li><strong>Integer</strong>��<strong>Float</strong>���Ͷ�ȡ4���ֽڣ�Long��<strong>Double</strong>���Ͷ�ȡ8���ֽڡ�</li>
<li><strong>Utf8</strong>���Ͷ�ȡ2���ֽڵĳ���Ȼ��Ȼ���ٶ�ȡ�ó��ȵ��ֽ�����</li>
<li><strong>String</strong>���Ͷ�ȡ2���ֽڵ�stringIndex(ָ��Utf8����)</li>
<li><strong>Class</strong>���Ͷ�ȡ2���ֽڵ�nameIndex(ָ��Utf8����)</li>
<li><strong>NameAndType</strong>���Ͷ�ȡ2���ֽڵ�nameIndex,2���ֽڵ�descriptorIndex����ָ��Utf8����</li>
<li><strong>Fieldref, Methodref</strong> �� <strong>InterfaceMethodref</strong> ����ȡ2���ֽڵ�classIndex(ָ��Class����)��2���ֽڵ�nameAndTypeIndex(ָ��NameAndType����)</li>
<li><strong>MethodHandle</strong>���Ͷ�ȡ1���ֽڵ�referenceKind��2���ֽڵ�referenceIndex, MethodType���Ͷ�ȡ2���ֽڵ�descriptorIndex��</li>
<li><strong>InvokeDynamic</strong>���Ͷ�ȡ2���ֽڵ�bootstrapMethodAttrIndex, 2���ֽڵ�nameAndTypeIndex(ָ��NameAndType����)</li>
</ol>
</li>
<li>��ȡ2���ֽڵ�<strong>accessFlags</strong></li>
<li>��ȡ2���ֽڵ�<strong>thisClass</strong> (ָ��constantPool Class����)</li>
<li>��ȡ2���ֽڵ�<strong>superClass</strong> (ָ��constantPool Class����)</li>
<li>��ȡ2���ֽڵĽӿڳ��ȣ�Ȼ����ݳ��ȶ�ȡ<strong>interfaces</strong> (һ��uint16���飬��ָ��constantPool Class����)</li>
<li><strong>fields</strong> ��ȡ2���ֽڵ�field���������ζ�ȡÿ��filed, ÿ��field�ȶ�ȡ2���ֽ�accessFlags, Ȼ���ȡ2���ֽڵ�nameIndex,2���ֽڵ�descriptorIndex(��ָ��Utf8����)��Ȼ���ȡattributes</li>
<li><strong>methods</strong> ��ȡ2���ֽڵ�method���������ζ�ȡÿ��method, ÿ��method�ȶ�ȡ2���ֽ�accessFlags, Ȼ���ȡ2���ֽڵ�nameIndex,2���ֽڵ�descriptorIndex(��ָ��Utf8����)��Ȼ���ȡattributes</li>
<li><strong>attributes</strong> ��ȡ2���ֽڵ�attribute���������ζ�ȡÿ��attribute, ÿ��attribute�ȶ�ȡ2���ֽڵ�attrNameIndex(ָ��Utf8����)����ȡutf8ֵattrName,Ȼ���ȡ4���ֽڵ����Գ��ȣ�����attrName������ͬ��attribute���͡�++Java������淶Ԥ����23�֣������Ƚ�������8�֡�23�ַ�3�飬1��������裬2Java�����裬3�ṩ�������ࡣ++<ol>
<li><strong>ConstantValue����</strong>����ȡ2���ֽڵ�index��ָ���������ã�����ָ��ʲô�������ֶ����;�����++������field_info,1++</li>
<li><strong>Deprecated</strong>���ͣ�����ǣ�����ȡ�ֽڡ� ++������ClassFile,field_info,method_info,3++</li>
<li><strong>Synthetic</strong>���ͣ�����ǣ�����ȡ�ֽڡ� ++������ClassFile,field_info,method_info,2++</li>
<li><strong>Code</strong>���ͣ��ȶ�ȡ2���ֽ�max_stack(������ջ������)��2���ֽ�max_locals(�ֲ��������С)��4���ֽ��ֽ��볤�ȣ�Ȼ���ȡ�ó��ȵ��ֽ���code�����Ŷ�ȡ�쳣��exceptionTable��attributes��++������method_info,1++<ol>
<li>exceptionTable�ȶ�ȡ2���ֽڵ��쳣���С��Ȼ�����ζ�ȡÿ���쳣��ÿ���쳣��ȡ2���ֽڵ�startPc��2���ֽڵ�endPc��2���ֽڵ�handlerPc��2���ֽڵ�catchType.</li>
</ol>
</li>
<li><strong>Exceptions</strong>���ͣ���¼�����׳��ļ�¼����ȡuint16����(�ȶ�ȡ2���ֽڵ������С��Ȼ�����ζ�ȡ2���ֽ�)��++������method_info,1++</li>
<li><strong>LineNumberTable</strong>���ͣ���ŷ������к���Ϣ���ȶ�ȡ2���ֽڵ��кű��С��Ȼ��ÿ���кű��ȡ2���ֽ�startPc,2���ֽ�lineNumber��++������Code��3++</li>
<li><strong>LocalVariableAttribute</strong>���ͣ���ŷ����ľֲ�������Ϣ���ȶ�ȡ2���ֽڵľֲ��������С��Ȼ��ÿ���ֲ�������ȡ2���ֽڵ�startPc��2���ֽ�length��2���ֽ�nameIndex��2���ֽ�descriptorIndex��2���ֽ�index��++������Code��3++</li>
<li><strong>SourceFile</strong>���ͣ���ȡ2���ֽ�sourceFileIndex(ָ��utf8��������)��++������ClassFile,3++</li>
</ol>
</li>
</ol>
<h4 id="1-2-ClassFile��u"><a href="#1-2-ClassFile��u" class="headerlink" title="1.2 ClassFile��ṹ"></a>1.2 ClassFile��ṹ</h4><p>����1.1�еĽ���������Զ��������ṹ��<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">type ClassFile struct &#123;</div><div class="line">	magic        uint32</div><div class="line">	minorVersion uint16</div><div class="line">	majorVersion uint16</div><div class="line">	constantPool ConstantPool</div><div class="line">	accessFlags  uint16</div><div class="line">	thisClass    uint16</div><div class="line">	superClass   uint16</div><div class="line">	interfaces   []uint16</div><div class="line">	fields       []*MemberInfo</div><div class="line">	methods      []*MemberInfo</div><div class="line">	attributes   []AttributeInfo</div><div class="line">&#125;</div><div class="line">/**</div><div class="line">    ��������ת��ΪClassFile</div><div class="line">*/</div><div class="line">func Parse(classData []byte) (cf *ClassFile, err error) &#123;</div><div class="line">	defer func() &#123;</div><div class="line">		if r := recover(); r != nil &#123;</div><div class="line">			var ok bool</div><div class="line">			err, ok = r.(error)</div><div class="line">			if !ok &#123;</div><div class="line">				err = fmt.Errorf(&quot;%v&quot;, r)</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;()</div><div class="line">	cr := &amp;ClassReader&#123;classData&#125;</div><div class="line">	cf = &amp;ClassFile&#123;&#125;</div><div class="line">	cf.read(cr)</div><div class="line">	return</div><div class="line">&#125;</div><div class="line">/**</div><div class="line">    ���ζ�ȡ�ֽڽ��н���</div><div class="line">*/</div><div class="line">func (self *ClassFile) read(reader *ClassReader) &#123;</div><div class="line">	self.readAndCheckMagic(reader)</div><div class="line">	self.readAndCheckVersion(reader)</div><div class="line">	self.constantPool = readConstantPool(reader)</div><div class="line">	self.accessFlags = reader.readUint16()</div><div class="line">	self.thisClass = reader.readUint16()</div><div class="line">	self.superClass = reader.readUint16()</div><div class="line">	self.interfaces = reader.readUint16s()</div><div class="line">	self.fields = readMembers(reader, self.constantPool)</div><div class="line">	self.methods = readMembers(reader, self.constantPool)</div><div class="line">	self.attributes = readAttributes(reader, self.constantPool)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>У��magicֵ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">func (self *ClassFile) readAndCheckMagic(reader *ClassReader) &#123;</div><div class="line">	magic := reader.readUint32()</div><div class="line">	if magic != 0xCAFEBABE &#123;</div><div class="line">		panic(&quot;java.lang.ClassFormatError: magic!&quot;)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>У��minor��major��version</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">func (self *ClassFile) readAndCheckVersion(reader *ClassReader) &#123;</div><div class="line">	self.minorVersion = reader.readUint16()</div><div class="line">	self.majorVersion = reader.readUint16()</div><div class="line">	switch self.majorVersion &#123;</div><div class="line">	case 45:</div><div class="line">		return</div><div class="line">	case 46, 47, 48, 49, 50, 51, 52:</div><div class="line">		if self.minorVersion == 0 &#123;</div><div class="line">			return</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	panic(&quot;java.lang.UnsupportedClassVersionError!&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="1-3-�����ؽu"><a href="#1-3-�����ؽu" class="headerlink" title="1.3 �����ؽṹ"></a>1.3 �����ؽṹ</h4><p>ClassFile�ж�ȡ�����أ����ﶨ�峣����������ͺͽṹ��   </p>
<p>��������</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">const (</div><div class="line">	CONSTANT_Class              = 7</div><div class="line">	CONSTANT_Fieldref           = 9</div><div class="line">	CONSTANT_Methodref          = 10</div><div class="line">	CONSTANT_InterfaceMethodref = 11</div><div class="line">	CONSTANT_String             = 8</div><div class="line">	CONSTANT_Integer            = 3</div><div class="line">	CONSTANT_Float              = 4</div><div class="line">	CONSTANT_Long               = 5</div><div class="line">	CONSTANT_Double             = 6</div><div class="line">	CONSTANT_NameAndType        = 12</div><div class="line">	CONSTANT_Utf8               = 1</div><div class="line">	CONSTANT_MethodHandle       = 15</div><div class="line">	CONSTANT_MethodType         = 16</div><div class="line">	CONSTANT_InvokeDynamic      = 18</div><div class="line">)</div></pre></td></tr></table></figure>
<p>����ConstantInfo�ṹ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">type ConstantInfo interface &#123;</div><div class="line">	readInfo(reader *ClassReader)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func readConstantInfo(reader *ClassReader, cp ConstantPool) ConstantInfo &#123;</div><div class="line">	tag := reader.readUint8()</div><div class="line">	c := newConstantInfo(tag, cp)</div><div class="line">	c.readInfo(reader)</div><div class="line">	return c</div><div class="line">&#125;</div><div class="line"></div><div class="line">func newConstantInfo(tag uint8, cp ConstantPool) ConstantInfo &#123;</div><div class="line">	switch tag &#123;</div><div class="line">	case CONSTANT_Integer:</div><div class="line">		return &amp;ConstantIntegerInfo&#123;&#125;</div><div class="line">	case CONSTANT_Float:</div><div class="line">		return &amp;ConstantFloatInfo&#123;&#125;</div><div class="line">	case CONSTANT_Long:</div><div class="line">		return &amp;ConstantLongInfo&#123;&#125;</div><div class="line">	case CONSTANT_Double:</div><div class="line">		return &amp;ConstantDoubleInfo&#123;&#125;</div><div class="line">	case CONSTANT_Utf8:</div><div class="line">		return &amp;ConstantUtf8Info&#123;&#125;</div><div class="line">	case CONSTANT_String:</div><div class="line">		return &amp;ConstantStringInfo&#123;cp: cp&#125;</div><div class="line">	case CONSTANT_Class:</div><div class="line">		return &amp;ConstantClassInfo&#123;cp: cp&#125;</div><div class="line">	case CONSTANT_Fieldref:</div><div class="line">		return &amp;ConstantFieldrefInfo&#123;ConstantMemberrefInfo&#123;cp: cp&#125;&#125;</div><div class="line">	case CONSTANT_Methodref:</div><div class="line">		return &amp;ConstantMethodrefInfo&#123;ConstantMemberrefInfo&#123;cp: cp&#125;&#125;</div><div class="line">	case CONSTANT_InterfaceMethodref:</div><div class="line">		return &amp;ConstantInterfaceMethodrefInfo&#123;ConstantMemberrefInfo&#123;cp: cp&#125;&#125; // FieldRef,MethodRef��InterfaceMethodRef����MemberRefʵ��</div><div class="line">	case CONSTANT_NameAndType:</div><div class="line">		return &amp;ConstantNameAndTypeInfo&#123;&#125;</div><div class="line">	case CONSTANT_MethodType:</div><div class="line">		return &amp;ConstantMethodTypeInfo&#123;&#125;</div><div class="line">	case CONSTANT_MethodHandle:</div><div class="line">		return &amp;ConstantMethodHandleInfo&#123;&#125;</div><div class="line">	case CONSTANT_InvokeDynamic:</div><div class="line">		return &amp;ConstantInvokeDynamicInfo&#123;&#125;</div><div class="line">	default:</div><div class="line">		panic(&quot;java.lang.ClassFormatError: constant pool tag!&quot;)</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>������ConstantPool</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">type ConstantPool []ConstantInfo</div><div class="line"></div><div class="line">func readConstantPool(reader *ClassReader) ConstantPool &#123;</div><div class="line">	cpCount := int(reader.readUint16())</div><div class="line">	cp := make([]ConstantInfo, cpCount)</div><div class="line"></div><div class="line">	for i := 1; i &lt; cpCount; i++ &#123;</div><div class="line">		cp[i] = readConstantInfo(reader, cp)</div><div class="line">		switch cp[i].(type) &#123;</div><div class="line">		case *ConstantLongInfo, *ConstantDoubleInfo:</div><div class="line">			i++ // long��double32λ</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return cp</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="1-4-��ͷ���"><a href="#1-4-��ͷ���" class="headerlink" title="1.4 ��ͷ���"></a>1.4 ��ͷ���</h4><p>��Ϊ��ͷ����Ķ�ȡ������ͬ���������ڲ�ͬ��attributes�����У���ͳһ��MemeberInfo�ṹ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">type MemberInfo struct &#123;</div><div class="line">	cp              ConstantPool</div><div class="line">	accessFlags     uint16</div><div class="line">	nameIndex       uint16</div><div class="line">	descriptorIndex uint16</div><div class="line">	attributes      []AttributeInfo</div><div class="line">&#125;</div><div class="line"></div><div class="line">func readMembers(reader *ClassReader, cp ConstantPool) []*MemberInfo &#123;</div><div class="line">	memberCount := reader.readUint16()</div><div class="line">	members := make([]*MemberInfo, memberCount)</div><div class="line">	for i := range members &#123;</div><div class="line">		members[i] = readMember(reader, cp)</div><div class="line">	&#125;</div><div class="line">	return members</div><div class="line">&#125;</div><div class="line"></div><div class="line">func readMember(reader *ClassReader, cp ConstantPool) *MemberInfo &#123;</div><div class="line">	return &amp;MemberInfo&#123;</div><div class="line">		cp:              cp,</div><div class="line">		accessFlags:     reader.readUint16(),</div><div class="line">		nameIndex:       reader.readUint16(),</div><div class="line">		descriptorIndex: reader.readUint16(),</div><div class="line">		attributes:      readAttributes(reader, cp),</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="1-5-����"><a href="#1-5-����" class="headerlink" title="1.5 ����"></a>1.5 ����</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">type AttributeInfo interface &#123;</div><div class="line">	readInfo(reader *ClassReader)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func readAttributes(reader *ClassReader, cp ConstantPool) []AttributeInfo &#123;</div><div class="line">	attributesCount := reader.readUint16()</div><div class="line">	attributes := make([]AttributeInfo, attributesCount)</div><div class="line">	for i := range attributes &#123;</div><div class="line">		attributes[i] = readAttribute(reader, cp)</div><div class="line">	&#125;</div><div class="line">	return attributes</div><div class="line">&#125;</div><div class="line"></div><div class="line">func readAttribute(reader *ClassReader, cp ConstantPool) AttributeInfo &#123;</div><div class="line">	attrNameIndex := reader.readUint16()</div><div class="line">	attrName := cp.getUtf8(attrNameIndex)</div><div class="line">	attrLen := reader.readUint32()</div><div class="line">	attrInfo := newAttributeInfo(attrName, attrLen, cp)</div><div class="line">	attrInfo.readInfo(reader)</div><div class="line">	return attrInfo</div><div class="line">&#125;</div><div class="line"></div><div class="line">func newAttributeInfo(attrName string, attrLen uint32, cp ConstantPool) AttributeInfo &#123;</div><div class="line">	switch attrName &#123;</div><div class="line">	case &quot;Code&quot;:</div><div class="line">		return &amp;CodeAttribute&#123;cp: cp&#125;</div><div class="line">	case &quot;ConstantValue&quot;:</div><div class="line">		return &amp;ConstantValueAttribute&#123;&#125;</div><div class="line">	case &quot;Deprecated&quot;:</div><div class="line">		return &amp;DeprecatedAttribute&#123;&#125;</div><div class="line">	case &quot;Exceptions&quot;:</div><div class="line">		return &amp;ExceptionsAttribute&#123;&#125;</div><div class="line">	case &quot;LineNumberTable&quot;:</div><div class="line">		return &amp;LineNumberTableAttribute&#123;&#125;</div><div class="line">	case &quot;LocalVariableTable&quot;:</div><div class="line">		return &amp;LocalVariableTableAttribute&#123;&#125;</div><div class="line">	case &quot;SourceFile&quot;:</div><div class="line">		return &amp;SourceFileAttribute&#123;cp: cp&#125;</div><div class="line">	case &quot;Synthetic&quot;:</div><div class="line">		return &amp;SyntheticAttribute&#123;&#125;</div><div class="line">	... //ƪ�����ޣ�������չ��</div><div class="line">	default:</div><div class="line">		return &amp;UnparsedAttribute&#123;name: attrName, length: attrLen&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>����Ǽ򵥵�Class�ļ���������Ϊƪ�����⣬setter/getter�������Ѿ�ConstantInfo�ӿڵ�ʵ�����AttributeInfo�ӿڵ�ʵ����Ȳ��ٸ�����</p>

  </section>

  
  
</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
